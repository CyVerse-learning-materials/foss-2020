

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction to Docker &mdash; CyVerse Learning Institute Foundations of Open Science Skills 2019 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/jquery.tablesorter.min.js"></script>
        <script type="text/javascript" src="../_static/cyverse.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/cyverse.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced Docker" href="dockeradvanced.html" />
    <link rel="prev" title="Introduction to BioContainers" href="biocontainers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> CyVerse Learning Institute Foundations of Open Science Skills 2019
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">FOSS 2020 Home</a></li>
</ul>
<p class="caption"><span class="caption-text">Before you Arrive</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../before/main.html"><strong>Before you arrive</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../before/installation.html"><strong>Pre-Workshop Setup</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../before/about_cyverse.html"><strong>About CyVerse</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/intro.html"><strong>FOSS 2020 Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/code_of_conduct.html"><strong>Code of Conduct</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/agenda.html"><strong>Agenda</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/agenda.html#syllabus-draft-subject-to-change"><strong>Syllabus (draft, subject to change)</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/open_sci_lab.html"><strong>Open Science Lab</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/colab_culture.html"><strong>Collaboration Culture and Roles</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/glossary.html"><strong>Glossary &amp; Acronyms</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">CyVerse</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CyVerse/intro_to_cyverse.html"><strong>Introduction to CyVerse</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../CyVerse/data_store.html"><strong>CyVerse Data Store</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../CyVerse/de.html"><strong>Discovery Environment</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../CyVerse/de-data-manage.html"><strong>Discovery Environment - Data Management</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../CyVerse/de-data-analysis.html"><strong>Discovery Environment - Data Analysis</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../CyVerse/vice.html"><strong>VICE</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../CyVerse/tool_integration_app_building_DE.html"><strong>Tool Integration into the DE</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../CyVerse/workflow.html"><strong>Creating Workflows</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Reproducible Science</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reproducible_science/intro.html"><strong>Introduction to Cloud Computing</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../reproducible_science/communication.html"><strong>Lab Group Communication</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../reproducible_science/websites.html"><strong>Websites &amp; Documentation</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../reproducible_science/version_control.html"><strong>Version Control</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Cloud Computing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cloud_comput/intro.html"><strong>Introduction to Reproducible Science</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloud_comput/atmo.html"><strong>Atmosphere</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloud_comput/xsede.html"><strong>Research Cyberinfrastructure associated with CyVerse</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloud_comput/cyberinfrastructure.html"><strong>Other Cyberinfrastructure Projects</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Data Management</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Data_management/overview.html"><strong>Data Management Overview</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data_management/FAIR.html"><strong>FAIR Data</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data_management/dmp.html"><strong>Data Management Plans (DMP)</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Software Essentials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software_essentials/linux.html"><strong>Basics of Linux</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_essentials/commandline.html"><strong>Command Line and the Unix Shell</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_essentials/R_Studio.html"><strong>Introduction to R &amp; RStudio</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_essentials/RStudio_Git.html"><strong>RStudio with Version Control</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../software_essentials/continuous_integration.html"><strong>Continuous Integration</strong></a></li>
</ul>
<p class="caption"><span class="caption-text">Containers</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="dockeronatmo.html">Launching a Docker app on Atmosphere</a></li>
<li class="toctree-l1"><a class="reference internal" href="biocontainers.html"><strong>Introduction to BioContainers</strong></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Introduction to Docker</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">1. Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker-installation">2. Docker Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#testing-docker-installation">2.1 Testing Docker installation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-docker-containers-from-prebuilt-images">3. Running Docker containers from prebuilt images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-docker-images-which-contain-your-own-code">4. Build Docker images which contain your own code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#deploying-a-command-line-app">4.1 Deploying a command-line app</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#docker-images">4.1.1 Docker images</a></li>
<li class="toctree-l4"><a class="reference internal" href="#meet-our-python-app">4.1.2 Meet our Python app</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#deploying-a-jupyter-notebook">4.2 Deploying a Jupyter Notebook</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#suitable-docker-images-for-a-base">4.2.1 Suitable Docker images for a base</a></li>
<li class="toctree-l4"><a class="reference internal" href="#meet-our-model">4.2.2 Meet our model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dockerfile-commands-summary">5. Dockerfile commands summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#demos">6. Demos</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#portainer">6.1 Portainer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installation">6.1.1 Installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#play-with-docker-pwd">6.2 Play-with-docker (PWD)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">6.2.1 Installation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dockeradvanced.html"><strong>Advanced Docker</strong></a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CyVerse Learning Institute Foundations of Open Science Skills 2019</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li><strong>Introduction to Docker</strong></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Containers/dockerintro.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction-to-docker">
<h1><strong>Introduction to Docker</strong><a class="headerlink" href="#introduction-to-docker" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="../_images/docker.png"><img alt="docker" src="../_images/docker.png" style="width: 250px;" /></a></p>
<div class="section" id="prerequisites">
<h2>1. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>There are no specific skills needed for this tutorial beyond a basic comfort with the command line and using a text editor. Prior experience in developing web applications will be helpful but is not required.</p>
</div>
<div class="section" id="docker-installation">
<h2>2. Docker Installation<a class="headerlink" href="#docker-installation" title="Permalink to this headline">¶</a></h2>
<p>Getting all the tooling setup on your computer can be a daunting task, but not with Docker. Getting Docker up and running on your favorite OS (Mac/Windows/Linux) is very easy.</p>
<p>The getting started guide on Docker has detailed instructions for setting up Docker on <a class="reference external" href="https://docs.docker.com/docker-for-mac/install/">Mac</a>/<a class="reference external" href="https://docs.docker.com/docker-for-windows/install/">Windows</a>/<a class="reference external" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">Linux</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you’re using Docker for Windows make sure you have <a class="reference external" href="https://docs.docker.com/docker-for-windows/#shared-drives">shared your drive</a>.</p>
<p>If you’re using an older version of Windows or MacOS you may need to use <a class="reference external" href="https://docs.docker.com/machine/overview/">Docker Machine</a> instead.</p>
<p>All commands work in either Bash or Powershell on Windows.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Depending on how you’ve installed Docker on your system, you might see a <code class="docutils literal notranslate"><span class="pre">permission</span> <span class="pre">denied</span></code> error after running the above command. If you’re on Linux, you may need to prefix your Docker commands with sudo. Alternatively to run docker command without sudo, you need to add your user (who has root privileges) to docker group.
For this run:</p>
<p>Create the docker group:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo groupadd docker
</pre></div>
</div>
<p>Add your user to the docker group:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo usermod -aG docker $USER
</pre></div>
</div>
<p>Log out and log back in so that your group membership is re-evaluated</p>
</div>
<div class="section" id="testing-docker-installation">
<h3>2.1 Testing Docker installation<a class="headerlink" href="#testing-docker-installation" title="Permalink to this headline">¶</a></h3>
<p>Once you are done installing Docker, test your Docker installation by running the following command to make sure you are using version 1.13 or higher:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker --version
Docker version <span class="m">18</span>.09.3, build 774a1f4
</pre></div>
</div>
<p>When run without <code class="docutils literal notranslate"><span class="pre">--version</span></code> you should see a whole bunch of lines showing the different options available with <code class="docutils literal notranslate"><span class="pre">docker</span></code>. Alternatively you can test your installation by running the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run hello-world
Unable to find image <span class="s1">&#39;hello-world:latest&#39;</span> locally
latest: Pulling from library/hello-world
03f4658f8b78: Pull <span class="nb">complete</span>
a3ed95caeb02: Pull <span class="nb">complete</span>
Digest: sha256:8be990ef2aeb16dbcb9271ddfe2610fa6658d13f6dfb8bc72074cc1ca36966a7
Status: Downloaded newer image <span class="k">for</span> hello-world:latest

Hello from Docker.
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 <span class="m">1</span>. The Docker client contacted the Docker daemon.
 <span class="m">2</span>. The Docker daemon pulled the <span class="s2">&quot;hello-world&quot;</span> image from the Docker Hub.
 <span class="m">3</span>. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 <span class="m">4</span>. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.
.......
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-docker-containers-from-prebuilt-images">
<h2>3. Running Docker containers from prebuilt images<a class="headerlink" href="#running-docker-containers-from-prebuilt-images" title="Permalink to this headline">¶</a></h2>
<p>Now that you have everything setup, it’s time to get our hands dirty. In this section, you are going to run a container from <a class="reference external" href="https://www.alpinelinux.org/">Alpine Linux</a> (a lightweight linux distribution) image on your system and get a taste of the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command.</p>
<p>But wait, what exactly is a container and image?</p>
<p><strong>Containers</strong> - Running instances of Docker images — containers run the actual applications. A container includes an application and all of its dependencies. It shares the kernel with other containers, and runs as an isolated process in user space on the host OS.</p>
<p><strong>Images</strong> - The file system and configuration of our application which are used to create containers. To find out more about a Docker image, run <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">inspect</span> <span class="pre">hello-world</span></code>. In the demo above, you could have used the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span></code> command to download the <code class="docutils literal notranslate"><span class="pre">hello-world</span></code> image. However when you executed the command <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">hello-world</span></code>, it also did a <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span></code> behind the scenes to download the <code class="docutils literal notranslate"><span class="pre">hello-world</span></code> image with <code class="docutils literal notranslate"><span class="pre">latest</span></code> tag (we will learn more about tags little later).</p>
<p>Now that we know what a container and image is, let’s run the following command in our terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run alpine ls -l
total <span class="m">52</span>
drwxr-xr-x    <span class="m">2</span> root     root          <span class="m">4096</span> Dec <span class="m">26</span>  <span class="m">2016</span> bin
drwxr-xr-x    <span class="m">5</span> root     root           <span class="m">340</span> Jan <span class="m">28</span> <span class="m">09</span>:52 dev
drwxr-xr-x   <span class="m">14</span> root     root          <span class="m">4096</span> Jan <span class="m">28</span> <span class="m">09</span>:52 etc
drwxr-xr-x    <span class="m">2</span> root     root          <span class="m">4096</span> Dec <span class="m">26</span>  <span class="m">2016</span> home
drwxr-xr-x    <span class="m">5</span> root     root          <span class="m">4096</span> Dec <span class="m">26</span>  <span class="m">2016</span> lib
drwxr-xr-x    <span class="m">5</span> root     root          <span class="m">4096</span> Dec <span class="m">26</span>  <span class="m">2016</span> media
........
</pre></div>
</div>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">hello-world</span></code> command in the demo above, <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">alpine</span> <span class="pre">ls</span> <span class="pre">-l</span></code> command fetches the <code class="docutils literal notranslate"><span class="pre">alpine:latest</span></code> image from the Docker registry first, saves it in our system and then runs a container from that saved image.</p>
<p>When you run <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">alpine</span></code>, you provided a command <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code>, so Docker started the command specified and you saw the listing</p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">images</span></code> command to see a list of all images on your system</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker images
REPOSITORY              TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
alpine                  latest              c51f86c28340        <span class="m">4</span> weeks ago         <span class="m">1</span>.109 MB
hello-world             latest              690ed74de00f        <span class="m">5</span> months ago        <span class="m">960</span> B
</pre></div>
</div>
<p>Let’s try something more exciting.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run alpine <span class="nb">echo</span> <span class="s2">&quot;Hello world&quot;</span>
Hello world
</pre></div>
</div>
<p>OK, that’s some actual output. In this case, the Docker client dutifully ran the <code class="docutils literal notranslate"><span class="pre">echo</span></code> command in our <code class="docutils literal notranslate"><span class="pre">alpine</span></code> container and then exited it. If you’ve noticed, all of that happened pretty quickly. Imagine booting up a virtual machine, running a command and then killing it. Now you know why they say containers are fast!</p>
<p>Try another command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run alpine sh
</pre></div>
</div>
<p>Wait, nothing happened! Is that a bug? Well, no. These interactive shells will exit after running any scripted commands such as <code class="docutils literal notranslate"><span class="pre">sh</span></code>, unless they are run in an interactive terminal - so for this example to not exit, you need to <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-it</span> <span class="pre">alpine</span> <span class="pre">sh</span></code>. You are now inside the container shell and you can try out a few commands like <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code>, <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-a</span></code> and others.</p>
<p>Before doing that, now it’s time to see the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span></code> command which shows you all containers that are currently running.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker ps
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</pre></div>
</div>
<p>Since no containers are running, you see a blank line. Let’s try a more useful variant: <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span> <span class="pre">-a</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                      PORTS               NAMES
36171a5da744        alpine              <span class="s2">&quot;/bin/sh&quot;</span>                <span class="m">5</span> minutes ago       Exited <span class="o">(</span><span class="m">0</span><span class="o">)</span> <span class="m">2</span> minutes ago                        fervent_newton
a6a9d46d0b2f        alpine             <span class="s2">&quot;echo &#39;hello from alp&quot;</span>    <span class="m">6</span> minutes ago       Exited <span class="o">(</span><span class="m">0</span><span class="o">)</span> <span class="m">6</span> minutes ago                        lonely_kilby
ff0a5c3750b9        alpine             <span class="s2">&quot;ls -l&quot;</span>                   <span class="m">8</span> minutes ago       Exited <span class="o">(</span><span class="m">0</span><span class="o">)</span> <span class="m">8</span> minutes ago                        elated_ramanujan
c317d0a9e3d2        hello-world         <span class="s2">&quot;/hello&quot;</span>                 <span class="m">34</span> seconds ago      Exited <span class="o">(</span><span class="m">0</span><span class="o">)</span> <span class="m">12</span> minutes ago                       stupefied_mcclintock
</pre></div>
</div>
<p>What you see above is a list of all containers that you ran. Notice that the STATUS column shows that these containers exited a few minutes ago.</p>
<p>If you want to run scripted commands such as <code class="docutils literal notranslate"><span class="pre">sh</span></code>, they should be run in an interactive terminal. In addition, interactive terminal allows you to run more than one command in a container. Let’s try that now:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run -it alpine sh
/ <span class="c1"># ls</span>
bin    dev    etc    home   lib    media  mnt    proc   root   run    sbin   srv    sys    tmp    usr    var
/ <span class="c1"># uname -a</span>
Linux de4bbc3eeaec <span class="m">4</span>.9.49-moby <span class="c1">#1 SMP Wed Sep 27 23:17:17 UTC 2017 x86_64 Linux</span>
</pre></div>
</div>
<p>Running the <code class="docutils literal notranslate"><span class="pre">run</span></code> command with the <code class="docutils literal notranslate"><span class="pre">-it</span></code> flags attaches us to an interactive <code class="docutils literal notranslate"><span class="pre">tty</span></code> in the container. Now you can run as many commands in the container as you want. Take some time to run your favorite commands.</p>
<p>Exit out of the container by giving the <code class="docutils literal notranslate"><span class="pre">exit</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/ <span class="c1"># exit</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you type <code class="docutils literal notranslate"><span class="pre">exit</span></code> your <strong>container</strong> will exit and is no longer active. To check that, try the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker ps -l
CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS                          PORTS                    NAMES
de4bbc3eeaec        alpine                &quot;/bin/sh&quot;                3 minutes ago       Exited (0) About a minute ago                            pensive_leavitt
</pre></div>
</div>
<p>If you want to keep the container active, then you can use keys <code class="docutils literal notranslate"><span class="pre">ctrl</span> <span class="pre">+p,</span> <span class="pre">ctrl</span> <span class="pre">+q</span></code>. To make sure that it is not exited run the same <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span> <span class="pre">-a</span></code> command again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker ps -l
CONTAINER ID        IMAGE                 COMMAND                  CREATED             STATUS                         PORTS                    NAMES
0db38ea51a48        alpine                &quot;sh&quot;                     3 minutes ago       Up 3 minutes                                            elastic_lewin
</pre></div>
</div>
<p>Now if you want to get back into that container, then you can type <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">attach</span> <span class="pre">&lt;container</span> <span class="pre">id&gt;</span></code>. This way you can save your container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker attach 0db38ea51a48
</pre></div>
</div>
</div>
</div>
<div class="section" id="build-docker-images-which-contain-your-own-code">
<h2>4. Build Docker images which contain your own code<a class="headerlink" href="#build-docker-images-which-contain-your-own-code" title="Permalink to this headline">¶</a></h2>
<p>Great! so you have now looked at <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>, played with a Docker containers and also got the hang of some terminology. Armed with all this knowledge, you are now ready to get to the real stuff — deploying your own applications with Docker.</p>
<div class="section" id="deploying-a-command-line-app">
<h3>4.1 Deploying a command-line app<a class="headerlink" href="#deploying-a-command-line-app" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Code for this section is in this repo in the <a class="reference external" href="https://github.com/CyVerse-learning-materials/container_camp_workshop_2019/tree/master/examples">examples/</a> directory</p>
</div>
<p>In this section, let’s dive deeper into what Docker images are. Later on we will build our own image and use that image to run an application locally.</p>
<div class="section" id="docker-images">
<h4>4.1.1 Docker images<a class="headerlink" href="#docker-images" title="Permalink to this headline">¶</a></h4>
<p>Docker images are the basis of containers. In the previous example, you pulled the <code class="docutils literal notranslate"><span class="pre">alpine</span></code> image from the registry and asked the Docker client to run a container based on that image. To see the list of images that are available locally on your system, run the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">images</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker images
REPOSITORY                 TAG                 IMAGE ID            CREATED             SIZE
ubuntu                     bionic              47b19964fb50        <span class="m">4</span> weeks ago         <span class="m">88</span>.1MB
alpine                     latest              caf27325b298        <span class="m">4</span> weeks ago         <span class="m">5</span>.53MB
hello-world                latest              fce289e99eb9        <span class="m">2</span> months ago        <span class="m">1</span>.84kB
.........
</pre></div>
</div>
<p>Above is a list of images that I’ve pulled from the registry and those I’ve created myself (we’ll shortly see how). You will have a different list of images on your machine. The <strong>TAG</strong> refers to a particular snapshot of the image and the <strong>ID</strong> is the corresponding unique identifier for that image.</p>
<p>For simplicity, you can think of an image akin to a git repository - images can be committed with changes and have multiple versions. When you do not provide a specific version number, the client defaults to latest.</p>
<p>For example you could pull a specific version of ubuntu image as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker pull ubuntu:16.04
</pre></div>
</div>
<p>If you do not specify the version number of the image, as mentioned, the Docker client will default to a version named <code class="docutils literal notranslate"><span class="pre">latest</span></code>.</p>
<p>So for example, the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span></code> command given below will pull an image named <code class="docutils literal notranslate"><span class="pre">ubuntu:latest</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker pull ubuntu
</pre></div>
</div>
<p>To get a new Docker image you can either get it from a registry (such as the Docker hub) or create your own. There are hundreds of thousands of images available on Docker hub. You can also search for images directly from the command line using <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">search</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker search ubuntu
  NAME                                                   DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
  ubuntu                                                 Ubuntu is a Debian-based Linux operating sys…   <span class="m">7310</span>                <span class="o">[</span>OK<span class="o">]</span>
  dorowu/ubuntu-desktop-lxde-vnc                         Ubuntu with openssh-server and NoVNC            <span class="m">163</span>                                     <span class="o">[</span>OK<span class="o">]</span>
  rastasheep/ubuntu-sshd                                 Dockerized SSH service, built on top of offi…   <span class="m">131</span>                                     <span class="o">[</span>OK<span class="o">]</span>
  ansible/ubuntu14.04-ansible                            Ubuntu <span class="m">14</span>.04 LTS with ansible                   <span class="m">90</span>                                      <span class="o">[</span>OK<span class="o">]</span>
  ubuntu-upstart                                         Upstart is an event-based replacement <span class="k">for</span> th…   <span class="m">81</span>                  <span class="o">[</span>OK<span class="o">]</span>
  neurodebian                                            NeuroDebian provides neuroscience research s…   <span class="m">43</span>                  <span class="o">[</span>OK<span class="o">]</span>
  ubuntu-debootstrap                                     debootstrap --variant<span class="o">=</span>minbase --components<span class="o">=</span>m…   <span class="m">35</span>                  <span class="o">[</span>OK<span class="o">]</span>
  1and1internet/ubuntu-16-nginx-php-phpmyadmin-mysql-5   ubuntu-16-nginx-php-phpmyadmin-mysql-5          <span class="m">26</span>                                      <span class="o">[</span>OK<span class="o">]</span>
  nuagebec/ubuntu                                        Simple always updated Ubuntu docker images w…   <span class="m">22</span>                                      <span class="o">[</span>OK<span class="o">]</span>
  tutum/ubuntu                                           Simple Ubuntu docker images with SSH access     <span class="m">18</span>
  ppc64le/ubuntu                                         Ubuntu is a Debian-based Linux operating sys…   <span class="m">11</span>
  i386/ubuntu                                            Ubuntu is a Debian-based Linux operating sys…   <span class="m">9</span>
  1and1internet/ubuntu-16-apache-php-7.0                 ubuntu-16-apache-php-7.0                        <span class="m">7</span>                                       <span class="o">[</span>OK<span class="o">]</span>
  eclipse/ubuntu_jdk8                                    Ubuntu, JDK8, Maven <span class="m">3</span>, git, curl, nmap, mc, …   <span class="m">5</span>                                       <span class="o">[</span>OK<span class="o">]</span>
  darksheer/ubuntu                                       Base Ubuntu Image -- Updated hourly             <span class="m">3</span>                                       <span class="o">[</span>OK<span class="o">]</span>
  codenvy/ubuntu_jdk8                                    Ubuntu, JDK8, Maven <span class="m">3</span>, git, curl, nmap, mc, …   <span class="m">3</span>                                       <span class="o">[</span>OK<span class="o">]</span>
  1and1internet/ubuntu-16-nginx-php-5.6-wordpress-4      ubuntu-16-nginx-php-5.6-wordpress-4             <span class="m">2</span>                                       <span class="o">[</span>OK<span class="o">]</span>
  1and1internet/ubuntu-16-nginx                          ubuntu-16-nginx                                 <span class="m">2</span>                                       <span class="o">[</span>OK<span class="o">]</span>
  pivotaldata/ubuntu                                     A quick freshening-up of the base Ubuntu doc…   <span class="m">1</span>
  smartentry/ubuntu                                      ubuntu with smartentry                          <span class="m">0</span>                                       <span class="o">[</span>OK<span class="o">]</span>
  pivotaldata/ubuntu-gpdb-dev                            Ubuntu images <span class="k">for</span> GPDB development              <span class="m">0</span>
  1and1internet/ubuntu-16-healthcheck                    ubuntu-16-healthcheck                           <span class="m">0</span>                                       <span class="o">[</span>OK<span class="o">]</span>
  thatsamguy/ubuntu-build-image                          Docker webapp build images based on Ubuntu      <span class="m">0</span>
  ossobv/ubuntu                                          Custom ubuntu image from scratch <span class="o">(</span>based on o…   <span class="m">0</span>
  1and1internet/ubuntu-16-sshd                           ubuntu-16-sshd                                  <span class="m">0</span>                                       <span class="o">[</span>OK<span class="o">]</span>
</pre></div>
</div>
<p>An important distinction with regard to images is between base images and child images and official images and user images (Both of which can be base images or child images.).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Base images</strong> are images that have no parent images, usually images with an OS like ubuntu, alpine or debian.</p>
<p><strong>Child images</strong> are images that build on base images and add additional functionality.</p>
<p><strong>Official images</strong> are Docker sanctioned images. Docker, Inc. sponsors a dedicated team that is responsible for reviewing and publishing all Official Repositories content. This team works in collaboration with upstream software maintainers, security experts, and the broader Docker community. These are not prefixed by an organization or user name. In the list of images above, the python, node, alpine and nginx images are official (base) images. To find out more about them, check out the Official Images Documentation.</p>
<p><strong>User images</strong> are images created and shared by users like you. They build on base images and add additional functionality. Typically these are formatted as <code class="docutils literal notranslate"><span class="pre">user/image-name</span></code>. The user value in the image name is your Dockerhub user or organization name.</p>
</div>
</div>
<div class="section" id="meet-our-python-app">
<h4>4.1.2 Meet our Python app<a class="headerlink" href="#meet-our-python-app" title="Permalink to this headline">¶</a></h4>
<p>Now that you have a better understanding of images, it’s time to create an image that sandboxes a small Python application. We’ll do this by creating a small Python script which prints a welcome message, then dockerizing it by writing a Dockerfile, and finally we’ll build the image and run it.</p>
<ul class="simple">
<li><p>Create a Python script</p></li>
<li><p>Build the image</p></li>
<li><p>Run your image</p></li>
</ul>
<ol class="arabic simple" id="create-a-python-script">
<li><p>Create a Python script which prints a welcome message</p></li>
</ol>
<p>Start by creating a directory called <code class="docutils literal notranslate"><span class="pre">simple-script</span></code> where we’ll create the following files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">app.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code></p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mkdir simple-script <span class="o">&amp;&amp;</span> <span class="nb">cd</span> simple-script
</pre></div>
</div>
<p id="app-py">1.1 <strong>app.py</strong></p>
<p>Create the <code class="docutils literal notranslate"><span class="pre">app.py</span></code> file with the following content. You can use any of favorite text editor to create this file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>print<span class="o">(</span><span class="s1">&#39;hello world!&#39;</span><span class="o">)</span>
print<span class="o">(</span><span class="s1">&#39;this is my first attempt&#39;</span><span class="o">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want, you can run this app through your laptop’s native Python installation first just to see what it looks like. Run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">app.py</span></code>.</p>
<p>You should see the message:</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">hello</span> <span class="pre">world!</span></code>
<code class="code docutils literal notranslate"><span class="pre">this</span> <span class="pre">is</span> <span class="pre">my</span> <span class="pre">first</span> <span class="pre">attempt</span></code></p>
</div></blockquote>
<p>This is totally optional - but some people like to see what the app’s supposed to do before they try to Dockerize it.</p>
</div>
<p id="dockerfile">1.2. <strong>Dockerfile</strong></p>
<p>A <strong>Dockerfile</strong> is a text file that contains a list of commands that the Docker daemon calls while creating an image. The Dockerfile contains all the information that Docker needs to know to run the app — a base Docker image to run from, location of your project code, any dependencies it has, and what commands to run at start-up. It is a simple way to automate the image creation process. The best part is that the commands you write in a Dockerfile are almost identical to their equivalent Linux commands. This means you don’t really have to learn new syntax to create your own Dockerfiles.</p>
<p>We want to create a Docker image with this app. As mentioned above, all user images are based on a base image. Since our application is written in Python, we will build our own Python image based on <code class="docutils literal notranslate"><span class="pre">Alpine</span></code>. We’ll do that using a Dockerfile.</p>
<p>Create a file called Dockerfile in the <code class="docutils literal notranslate"><span class="pre">simple-script</span></code> directory, and add content to it as described below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># our base image# our base image</span>
FROM alpine:3.9

<span class="c1"># install python and pip</span>
RUN apk add --update py3-pip

<span class="c1"># copy files required for the app to run</span>
COPY app.py /usr/src/app/

<span class="c1"># run the application</span>
CMD python3 /usr/src/app/app.py
</pre></div>
</div>
<p>Now let’s see what each of those lines mean..</p>
<p>1.2.1 We’ll start by specifying our base image, using the FROM keyword:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>FROM alpine:3.9
</pre></div>
</div>
<p>1.2.2. The next step usually is to write the commands of copying the files and installing the dependencies. But first we will install the Python pip package to the alpine linux distribution. This will not just install the pip package but any other dependencies too, which includes the python interpreter. Add the following <code class="docutils literal notranslate"><span class="pre">RUN</span></code> command next:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>RUN apk add --update py3-pip
</pre></div>
</div>
<p>1.2.3. Copy the file you have created earlier into our image by using <code class="docutils literal notranslate"><span class="pre">COPY</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>COPY app.py /usr/src/app/
</pre></div>
</div>
<p>1.2.4. The last step is the command for running the application. Use the <code class="docutils literal notranslate"><span class="pre">CMD</span></code> command to do that:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CMD python3 /usr/src/app/app.py
</pre></div>
</div>
<p>The primary purpose of <code class="docutils literal notranslate"><span class="pre">CMD</span></code> is to tell the container which command it should run by default when it is started.</p>
<ol class="arabic simple" id="build-the-image" start="2">
<li><p>Build the image</p></li>
</ol>
<p>Now that you have your Dockerfile, you can build your image. The <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code> command does the heavy-lifting of creating a docker image from a Dockerfile.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span> <span class="pre">command</span></code> is quite simple - it takes an optional tag name with the <code class="docutils literal notranslate"><span class="pre">-t</span></code> flag, and the location of the directory containing the Dockerfile - the <code class="docutils literal notranslate"><span class="pre">.</span></code> indicates the current directory:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you run the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code> command given below, make sure to replace <code class="docutils literal notranslate"><span class="pre">&lt;YOUR_DOCKERHUB_USERNAME&gt;</span></code> with your username. This username should be the same one you created when registering on Docker hub. If you haven’t done that yet, please go ahead and create an account in <a class="reference external" href="https://hub.docker.com">Dockerhub</a>.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">YOUR_DOCKERHUB_USERNAME</span><span class="o">=</span>&lt;YOUR_DOCKERHUB_USERNAME&gt;
</pre></div>
</div>
<p>For example this is how I assign my dockerhub username</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">YOUR_DOCKERHUB_USERNAME</span><span class="o">=</span>jpistorius
</pre></div>
</div>
<p>Now build the image using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker build -t <span class="nv">$YOUR_DOCKERHUB_USERNAME</span>/simple-script .
Sending build context to Docker daemon  <span class="m">10</span>.24kB
Step <span class="m">1</span>/4 : FROM alpine:3.9
 ---&gt; caf27325b298
Step <span class="m">2</span>/4 : RUN apk add --update py3-pip
 ---&gt; Using cache
 ---&gt; dad2a197fcad
Step <span class="m">3</span>/4 : COPY app.py /usr/src/app/
 ---&gt; Using cache
 ---&gt; a8ebf6cd2735
Step <span class="m">4</span>/4 : CMD python3 /usr/src/app/app.py
 ---&gt; Using cache
 ---&gt; a1fb2906a937
Successfully built a1fb2906a937
Successfully tagged jpistorius/simple-script:latest
</pre></div>
</div>
<p>If you don’t have the <code class="docutils literal notranslate"><span class="pre">alpine:3.9</span> <span class="pre">image</span></code>, the client will first pull the image and then create your image. Therefore, your output on running the command will look different from mine. If everything went well, your image should be ready! Run <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">images</span></code> and see if your image <code class="docutils literal notranslate"><span class="pre">$YOUR_DOCKERHUB_USERNAME/simple-script</span></code> shows.</p>
<ol class="arabic simple" id="run-your-image" start="3">
<li><p>Run your image</p></li>
</ol>
<p>When Docker can successfully build your Dockerfile, test it by starting a new container from your new image using the docker run command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run <span class="nv">$YOUR_DOCKERHUB_USERNAME</span>/simple-script
</pre></div>
</div>
<p>You should see something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>hello world!
this is my first attempt
</pre></div>
</div>
</div>
</div>
<div class="section" id="deploying-a-jupyter-notebook">
<h3>4.2 Deploying a Jupyter Notebook<a class="headerlink" href="#deploying-a-jupyter-notebook" title="Permalink to this headline">¶</a></h3>
<p>In this section, let’s build a Docker image which can run a Jupyter Notebook</p>
<div class="section" id="suitable-docker-images-for-a-base">
<h4>4.2.1 Suitable Docker images for a base<a class="headerlink" href="#suitable-docker-images-for-a-base" title="Permalink to this headline">¶</a></h4>
<p>Search for images on Docker Hub which contain the string ‘jupyter’</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker search jupyter
NAME                                   DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
jupyter/datascience-notebook           Jupyter Notebook Data Science Stack from htt…   <span class="m">446</span>
jupyter/all-spark-notebook             Jupyter Notebook Python, Scala, R, Spark, Me…   <span class="m">223</span>
jupyterhub/jupyterhub                  JupyterHub: multi-user Jupyter notebook serv…   <span class="m">195</span>                                     <span class="o">[</span>OK<span class="o">]</span>
jupyter/scipy-notebook                 Jupyter Notebook Scientific Python Stack fro…   <span class="m">155</span>
jupyter/tensorflow-notebook            Jupyter Notebook Scientific Python Stack w/ …   <span class="m">116</span>
jupyter/pyspark-notebook               Jupyter Notebook Python, Spark, Mesos Stack …   <span class="m">95</span>
jupyter/minimal-notebook               Minimal Jupyter Notebook Stack from https://…   <span class="m">73</span>
ermaker/keras-jupyter                  Jupyter with Keras <span class="o">(</span>with Theano backend and …   <span class="m">66</span>                                      <span class="o">[</span>OK<span class="o">]</span>
jupyter/base-notebook                  Small base image <span class="k">for</span> Jupyter Notebook stacks…   <span class="m">60</span>
xblaster/tensorflow-jupyter            Dockerized Jupyter with tensorflow              <span class="m">52</span>                                      <span class="o">[</span>OK<span class="o">]</span>
jupyter/r-notebook                     Jupyter Notebook R Stack from https://github…   <span class="m">22</span>
jupyterhub/singleuser                  single-user docker images <span class="k">for</span> use with Jupyt…   <span class="m">21</span>                                      <span class="o">[</span>OK<span class="o">]</span>
...
</pre></div>
</div>
</div>
<div class="section" id="meet-our-model">
<h4>4.2.2 Meet our model<a class="headerlink" href="#meet-our-model" title="Permalink to this headline">¶</a></h4>
<p>Let’s deploy a Python function inside a Docker image along with Jupyter.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#create-a-python-file-containing-a-function">Create a Python file containing a function</a></p></li>
<li><p><a href="#id6"><span class="problematic" id="id7">`Build the image`_</span></a></p></li>
<li><p><a href="#id8"><span class="problematic" id="id9">`Run your image`_</span></a></p></li>
</ul>
<ol class="arabic simple" id="create-a-python-file-containing-a-function">
<li><p>Create a Python file containing a function</p></li>
</ol>
<p>Start by creating a directory called <code class="docutils literal notranslate"><span class="pre">myfirstapp</span></code> where we’ll create the following files:</p>
<ul class="simple">
<li><p>model.py</p></li>
<li><p>Dockerfile</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mkdir myfirstapp <span class="o">&amp;&amp;</span> <span class="nb">cd</span> myfirstapp
</pre></div>
</div>
<p id="model-py">1.1 <strong>model.py</strong></p>
<p>Create the <code class="docutils literal notranslate"><span class="pre">model.py</span></code> file with the following content. You can use any of favorite text editor to create this file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>def introduce<span class="o">(</span>name<span class="o">)</span>:
    <span class="k">return</span> <span class="s1">&#39;Hello &#39;</span> + name
</pre></div>
</div>
<p id="id1">1.2. <strong>Dockerfile</strong></p>
<p>Since we want to use a Jupyter notebook to call our function, we will build an image based on <code class="docutils literal notranslate"><span class="pre">jupyter/minimal-notebook</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is one of the official Docker images provided by the Jupyter project for you to build your own data science notebooks on:</p>
<p><a class="reference external" href="https://jupyter-docker-stacks.readthedocs.io/en/latest/">https://jupyter-docker-stacks.readthedocs.io/en/latest/</a></p>
</div>
<p>Create a file called Dockerfile in the <code class="docutils literal notranslate"><span class="pre">myfirstapp</span></code> directory, and add content to it as described below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># our base image</span>
FROM jupyter/minimal-notebook

<span class="c1"># copy files required for the model to work</span>
COPY model.py /home/jovyan/work/

<span class="c1"># tell the port number the container should expose</span>
EXPOSE <span class="m">8888</span>
</pre></div>
</div>
<p>Now let’s see what each of those lines mean..</p>
<p>1.2.1 We’ll start by specifying our base image, using the FROM keyword:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>FROM jupyter/minimal-notebook
</pre></div>
</div>
<p>1.2.2. Copy the file you have created earlier into our image by using <code class="docutils literal notranslate"><span class="pre">COPY</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>COPY model.py /home/jovyan/work/
</pre></div>
</div>
<p>1.2.3. Specify the port number which needs to be exposed. Since Jupyter runs on 8888 that’s what we’ll expose.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>EXPOSE <span class="m">8888</span>
</pre></div>
</div>
<p>1.2.4. What about <code class="docutils literal notranslate"><span class="pre">CMD</span></code>?</p>
<p>Notice that unlike our previous Dockerfile this one does not end with a <code class="docutils literal notranslate"><span class="pre">CMD</span></code> command. This is on purpose.</p>
<p>Remember: The primary purpose of <code class="docutils literal notranslate"><span class="pre">CMD</span></code> is to tell the container which command it should run by default when it is started.</p>
<p>Can you guess what will happen if we don’t specify our own ‘entrypoint’ using <code class="docutils literal notranslate"><span class="pre">CMD</span></code>?</p>
<ol class="arabic simple" id="id2" start="2">
<li><p>Build the image</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember to replace <code class="docutils literal notranslate"><span class="pre">&lt;YOUR_DOCKERHUB_USERNAME&gt;</span></code> with your username. This username should be the same one you created when registering on Docker hub.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">YOUR_DOCKERHUB_USERNAME</span><span class="o">=</span>&lt;YOUR_DOCKERHUB_USERNAME&gt;
</pre></div>
</div>
<p>For example this is how I assign my dockerhub username</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">YOUR_DOCKERHUB_USERNAME</span><span class="o">=</span>jpistorius
</pre></div>
</div>
<p>Now build the image using the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker build -t <span class="nv">$YOUR_DOCKERHUB_USERNAME</span>/myfirstapp .
Sending build context to Docker daemon  <span class="m">3</span>.072kB
Step <span class="m">1</span>/3 : FROM jupyter/minimal-notebook
 ---&gt; 36c8dd0e1d8f
Step <span class="m">2</span>/3 : COPY model.py /home/jovyan/work/
 ---&gt; b61aefd7a735
Step <span class="m">3</span>/3 : EXPOSE <span class="m">8888</span>
 ---&gt; Running in 519dcabe4eb3
Removing intermediate container 519dcabe4eb3
 ---&gt; 7983fe164dc6
Successfully built 7983fe164dc6
Successfully tagged jpistorius/myfirstapp:latest
</pre></div>
</div>
<p>If everything went well, your image should be ready! Run <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">images</span></code> and see if your image <code class="docutils literal notranslate"><span class="pre">$YOUR_DOCKERHUB_USERNAME/myfirstapp</span></code> shows.</p>
<ol class="arabic simple" id="id3" start="3">
<li><p>Run your image</p></li>
</ol>
<p>When Docker can successfully build your Dockerfile, test it by starting a new container from your new image using the docker run command. Don’t forget to include the port forwarding options you learned about before.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker run -p <span class="m">8888</span>:8888 <span class="nv">$YOUR_DOCKERHUB_USERNAME</span>/myfirstapp
</pre></div>
</div>
<p>You should see something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Executing the command: jupyter notebook
<span class="o">[</span>I <span class="m">07</span>:21:25.396 NotebookApp<span class="o">]</span> Writing notebook server cookie secret to /home/jovyan/.local/share/jupyter/runtime/notebook_cookie_secret
<span class="o">[</span>I <span class="m">07</span>:21:25.609 NotebookApp<span class="o">]</span> JupyterLab extension loaded from /opt/conda/lib/python3.7/site-packages/jupyterlab
<span class="o">[</span>I <span class="m">07</span>:21:25.609 NotebookApp<span class="o">]</span> JupyterLab application directory is /opt/conda/share/jupyter/lab
<span class="o">[</span>I <span class="m">07</span>:21:25.611 NotebookApp<span class="o">]</span> Serving notebooks from <span class="nb">local</span> directory: /home/jovyan
<span class="o">[</span>I <span class="m">07</span>:21:25.611 NotebookApp<span class="o">]</span> The Jupyter Notebook is running at:
<span class="o">[</span>I <span class="m">07</span>:21:25.611 NotebookApp<span class="o">]</span> http://<span class="o">(</span>29a022bb5807 or <span class="m">127</span>.0.0.1<span class="o">)</span>:8888/?token<span class="o">=</span>copy-your-own-token-not-this-one
<span class="o">[</span>I <span class="m">07</span>:21:25.611 NotebookApp<span class="o">]</span> Use Control-C to stop this server and shut down all kernels <span class="o">(</span>twice to skip confirmation<span class="o">)</span>.
<span class="o">[</span>C <span class="m">07</span>:21:25.612 NotebookApp<span class="o">]</span>

    Copy/paste this URL into your browser when you connect <span class="k">for</span> the first time,
    to login with a token:
        http://<span class="o">(</span>29a022bb5807 or <span class="m">127</span>.0.0.1<span class="o">)</span>:8888/?token<span class="o">=</span>copy-your-own-token-not-this-one
</pre></div>
</div>
<p>Head over to <a class="reference external" href="http://localhost:8888">http://localhost:8888</a> and your Jupyter notebook server should be running.</p>
<p>Note: Copy the token from your own <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> output and paste it into the ‘Password or token’ input box.</p>
</div>
</div>
</div>
<div class="section" id="dockerfile-commands-summary">
<h2>5. Dockerfile commands summary<a class="headerlink" href="#dockerfile-commands-summary" title="Permalink to this headline">¶</a></h2>
<p>Here’s a quick summary of the few basic commands we used in our Dockerfiles.</p>
<ul class="simple">
<li><p><strong>FROM</strong> starts the Dockerfile. It is a requirement that the Dockerfile must start with the FROM command. Images are created in layers, which means you can use another image as the base image for your own. The FROM command defines your base layer. As arguments, it takes the name of the image. Optionally, you can add the Dockerhub username of the maintainer and image version, in the format username/imagename:version.</p></li>
<li><p><strong>RUN</strong> is used to build up the Image you’re creating. For each RUN command, Docker will run the command then create a new layer of the image. This way you can roll back your image to previous states easily. The syntax for a RUN instruction is to place the full text of the shell command after the RUN (e.g., RUN mkdir /user/local/foo). This will automatically run in a /bin/sh shell. You can define a different shell like this: RUN /bin/bash -c ‘mkdir /user/local/foo’</p></li>
<li><p><strong>COPY</strong> copies local files into the container.</p></li>
<li><p><strong>CMD</strong> defines the commands that will run on the Image at start-up. Unlike a RUN, this does not create a new layer for the Image, but simply runs the command. There can only be one CMD per a Dockerfile/Image. If you need to run multiple commands, the best way to do that is to have the CMD run a script. CMD requires that you tell it where to run the command, unlike RUN. So example CMD commands would be:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CMD <span class="o">[</span><span class="s2">&quot;python&quot;</span>, <span class="s2">&quot;./app.py&quot;</span><span class="o">]</span>

CMD <span class="o">[</span><span class="s2">&quot;/bin/bash&quot;</span>, <span class="s2">&quot;echo&quot;</span>, <span class="s2">&quot;Hello World&quot;</span><span class="o">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>EXPOSE creates a hint for users of an image which ports provide services. It is included in the information which can be retrieved via <code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">docker</span> <span class="pre">inspect</span> <span class="pre">&lt;container-id&gt;</span></code>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The EXPOSE command does not actually make any ports accessible to the host! Instead, this requires publishing ports by means of the <code class="docutils literal notranslate"><span class="pre">-p</span></code> flag when using <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>.</p>
</div>
<ul class="simple">
<li><p>PUSH pushes your image to Docker Cloud, or alternately to a private registry</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to learn more about Dockerfiles, check out <a class="reference external" href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/">Best practices for writing Dockerfiles</a>.</p>
</div>
</div>
<div class="section" id="demos">
<h2>6. Demos<a class="headerlink" href="#demos" title="Permalink to this headline">¶</a></h2>
<div class="section" id="portainer">
<h3>6.1 Portainer<a class="headerlink" href="#portainer" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://portainer.io/">Portainer</a> is an open-source lightweight managment UI which allows you to easily manage your Docker hosts or Swarm cluster.</p>
<ul class="simple">
<li><p>Simple to use: It has never been so easy to manage Docker. Portainer provides a detailed overview of Docker and allows you to manage containers, images, networks and volumes. It is also really easy to deploy, you are just one Docker command away from running Portainer anywhere.</p></li>
<li><p>Made for Docker: Portainer is meant to be plugged on top of the Docker API. It has support for the latest versions of Docker, Docker Swarm and Swarm mode.</p></li>
</ul>
<div class="section" id="installation">
<h4>6.1.1 Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h4>
<p>Use the following Docker commands to deploy Portainer. Now the second line of command should be familiar to you by now. We will talk about first line of command in the Advanced Docker session.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ docker volume create portainer_data

$ docker run -d -p <span class="m">9000</span>:9000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer
</pre></div>
</div>
<ul class="simple">
<li><p>If you are on mac, you’ll just need to access the port 9000 (<a class="reference external" href="http://localhost:9000">http://localhost:9000</a>) of the Docker engine where portainer is running using username <code class="docutils literal notranslate"><span class="pre">admin</span></code> and password <code class="docutils literal notranslate"><span class="pre">tryportainer</span></code></p></li>
<li><p>If you are running Docker on Atmosphere/Jetstream or on any other cloud, you can open <code class="docutils literal notranslate"><span class="pre">ipaddress:9000</span></code>. For my case this is <code class="docutils literal notranslate"><span class="pre">http://128.196.142.26:9000</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <cite>-v /var/run/docker.sock:/var/run/docker.sock</cite> option can be used in mac/linux environments only.</p>
</div>
<p><a class="reference internal" href="../_images/portainer_demo.png"><img alt="portainer_demo" src="../_images/portainer_demo.png" style="width: 500px;" /></a></p>
</div>
</div>
<div class="section" id="play-with-docker-pwd">
<h3>6.2 Play-with-docker (PWD)<a class="headerlink" href="#play-with-docker-pwd" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://labs.play-with-docker.com/">PWD</a> is a Docker playground which allows users to run Docker commands in a matter of seconds. It gives the experience of having a free Alpine Linux Virtual Machine in browser, where you can build and run Docker containers and even create clusters in <a class="reference external" href="https://docs.docker.com/engine/swarm/">Docker Swarm Mode</a>. Under the hood, Docker-in-Docker (DinD) is used to give the effect of multiple VMs/PCs. In addition to the playground, PWD also includes a training site composed of a large set of Docker labs and quizzes from beginner to advanced level available at <a class="reference external" href="https://training.play-with-docker.com/">training.play-with-docker.com</a>.</p>
<div class="section" id="id5">
<h4>6.2.1 Installation<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>You don’t have to install anything to use PWD. Just open <code class="docutils literal notranslate"><span class="pre">https://labs.play-with-docker.com/</span></code> &lt;<a class="reference external" href="https://labs.play-with-docker.com/">https://labs.play-with-docker.com/</a>&gt;`_ and start using PWD</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use your Dockerhub credentials to log-in to PWD</p>
</div>
<p><a class="reference internal" href="../_images/pwd.png"><img alt="pwd" src="../_images/pwd.png" style="width: 500px;" /></a></p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dockeradvanced.html" class="btn btn-neutral float-right" title="Advanced Docker" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="biocontainers.html" class="btn btn-neutral float-left" title="Introduction to BioContainers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, CyVerse

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>